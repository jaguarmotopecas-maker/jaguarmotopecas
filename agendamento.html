<script>
const form = document.getElementById("formAgendamento");

form.addEventListener("submit", async (e) => {
  e.preventDefault(); // impede recarregar a p√°gina

  // Valores do formul√°rio
  const nomeCliente = document.getElementById("nome").value.trim();
  const telefoneCliente = document.getElementById("telefone").value.trim();
  const moto = document.getElementById("moto").value.trim();
  const modelo = document.getElementById("modelo").value.trim();
  const ano = document.getElementById("ano").value.trim();
  const data = document.getElementById("data").value;
  const hora = document.getElementById("hora").value;
  const servico = document.getElementById("servico").value;

  if(!nomeCliente || !telefoneCliente || !moto || !modelo || !ano || !data || !hora || !servico){
    alert("‚ùå Preencha todos os campos!");
    return;
  }

  try {
    // Salva no Firestore
    await db.collection("agendamentos").add({
      nome: nomeCliente,
      telefone: telefoneCliente,
      moto,
      modelo,
      ano,
      data,
      hora,
      servico,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("‚úÖ Agendamento salvo com sucesso!");

    // --- ENVIA WHATSAPP ---

    // 1Ô∏è‚É£ WhatsApp da loja (coloque o n√∫mero da sua loja)
    const numeroLoja = "5585921496714"; // EXEMPLO: 55 + DDD + n√∫mero
    const msgLoja = `üìÖ *Novo agendamento*\nCliente: ${nomeCliente}\nTelefone: ${telefoneCliente}\nMoto: ${moto} ${modelo}\nAno: ${ano}\nServi√ßo: ${servico}\nData/Hora: ${data} ${hora}`;
    window.open(`https://wa.me/${numeroLoja}?text=${encodeURIComponent(msgLoja)}`, "_blank");

    // 2Ô∏è‚É£ WhatsApp do cliente
    const numeroCliente = telefoneCliente.replace(/\D/g, ""); // remove caracteres n√£o num√©ricos
    const msgCliente = `Ol√° ${nomeCliente}! Seu agendamento para ${moto} ${modelo} (${servico}) foi confirmado para ${data} √†s ${hora}. Obrigado!`;
    window.open(`https://wa.me/55${numeroCliente}?text=${encodeURIComponent(msgCliente)}`, "_blank");

    // Limpa o formul√°rio
    form.reset();

  } catch (error) {
    alert("‚ùå Erro ao salvar: " + error.message);
  }
});

// Fun√ß√£o voltar
function voltar(){
  location.href = "index.html";
}
</script>
