<script>
const form = document.getElementById("formAgendamento");
const btnSalvar = document.getElementById("btnSalvar");

btnSalvar.addEventListener("click", async (e) => {
  e.preventDefault(); // evita recarregar a p√°gina

  // Pegando valores do formul√°rio
  const nomeCliente = document.getElementById("nome").value.trim();
  const telefoneCliente = document.getElementById("telefone").value.trim();
  const moto = document.getElementById("moto").value.trim();
  const modelo = document.getElementById("modelo").value.trim();
  const ano = document.getElementById("ano").value.trim();
  const data = document.getElementById("data").value;
  const hora = document.getElementById("hora").value;
  const servico = document.getElementById("servico").value;

  if(!nomeCliente || !telefoneCliente || !moto || !modelo || !ano || !data || !hora || !servico){
    alert("‚ùå Preencha todos os campos!");
    return;
  }

  try {
    // Salva no Firestore
    await db.collection("agendamentos").add({
      nome: nomeCliente,
      telefone: telefoneCliente,
      moto,
      modelo,
      ano,
      data,
      hora,
      servico,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("‚úÖ Agendamento salvo com sucesso!");

    // --- Prepara links WhatsApp ---
    const numeroLoja = "559999999999"; // Coloque seu n√∫mero da loja
    const numeroCliente = telefoneCliente.replace(/\D/g, "");

    const msgLoja = `üìÖ *Novo agendamento*\nCliente: ${nomeCliente}\nTelefone: ${telefoneCliente}\nMoto: ${moto} ${modelo}\nAno: ${ano}\nServi√ßo: ${servico}\nData/Hora: ${data} ${hora}`;
    const msgCliente = `Ol√° ${nomeCliente}! Seu agendamento para ${moto} ${modelo} (${servico}) foi confirmado para ${data} √†s ${hora}. Obrigado!`;

    // Cria conte√∫do HTML para a aba de WhatsApp
    const html = `
      <h2>Agendamento salvo com sucesso!</h2>
      <p>Clique nos bot√µes abaixo para enviar a confirma√ß√£o via WhatsApp:</p>
      <button onclick="window.open('https://wa.me/${numeroLoja}?text=${encodeURIComponent(msgLoja)}', '_blank')">Enviar para Loja</button>
      <button onclick="window.open('https://wa.me/55${numeroCliente}?text=${encodeURIComponent(msgCliente)}', '_blank')">Enviar para Cliente</button>
    `;

    // Abre uma aba √∫nica
    const win = window.open("", "_blank");
    win.document.body.innerHTML = html;
    win.document.title = "Agendamento - WhatsApp";

    // Limpa formul√°rio
    form.reset();

  } catch (error) {
    alert("‚ùå Erro ao salvar: " + error.message);
  }
});

// Fun√ß√£o voltar
function voltar(){
  location.href = "index.html";
}
</script>
